<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Personal Firefox Notes</title>
    <style>
        :root { --primary: #0060df; --background: #f0f0f4; }
        body { font-family: -apple-system, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: var(--background); }
        .container { display: grid; gap: 1rem; grid-template-columns: 1fr; }
        #noteForm { display: grid; gap: 1rem; margin-bottom: 2rem; }
        textarea { height: 150px; padding: 1rem; border: 2px solid var(--primary); border-radius: 4px; resize: vertical; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        .note { background: white; padding: 1rem; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative; }
        .note-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 8px; }
    </style>
</head>
<body>
    <h1>Firefox Synced Notes</h1>
    
    <form id="noteForm">
        <textarea id="noteContent" placeholder="Start typing..."></textarea>
        <button type="submit">Save Note</button>
    </form>

    <div id="notesList" class="container"></div>

    <script>
        // Initialize Firefox Notes integration
        let isFirefox = typeof InstallTrigger !== 'undefined';
        let notes = JSON.parse(localStorage.getItem('ff-notes') || '[]');
        
        // Firefox Sync integration
        async function syncWithFirefox() {
            if (!isFirefox) return;
            
            try {
                // Attempt to use Firefox's experimental notes API
                const remoteNotes = await browser.storage.sync.get('notes');
                if (remoteNotes.notes) {
                    notes = [...notes, ...remoteNotes.notes.filter(n => 
                        !notes.some(localNote => localNote.id === n.id)
                    )];
                    localStorage.setItem('ff-notes', JSON.stringify(notes));
                }
                await browser.storage.sync.set({ notes });
                renderNotes();
            } catch (error) {
                console.log('Firefox Sync unavailable, using localStorage');
            }
        }

        // CRUD Operations
        function createNote(content) {
            const note = {
                id: Date.now(),
                content,
                created: new Date().toISOString(),
                updated: new Date().toISOString()
            };
            notes.unshift(note);
            updateStorage();
        }

        function updateNote(id, newContent) {
            const note = notes.find(n => n.id === id);
            note.content = newContent;
            note.updated = new Date().toISOString();
            updateStorage();
        }

        function deleteNote(id) {
            notes = notes.filter(note => note.id !== id);
            updateStorage();
        }

        function updateStorage() {
            localStorage.setItem('ff-notes', JSON.stringify(notes));
            if (isFirefox) {
                browser.storage.sync.set({ notes }).catch(() => {
                    console.log('Sync failed, using local storage');
                });
            }
            renderNotes();
        }

        function renderNotes() {
            const container = document.getElementById('notesList');
            container.innerHTML = notes.map(note => `
                <div class="note" data-id="${note.id}">
                    <div class="note-actions">
                        <button onclick="editNote(${note.id})">‚úèÔ∏è</button>
                        <button onclick="deleteNote(${note.id})">üóëÔ∏è</button>
                    </div>
                    <div class="content">${note.content.replace(/\n/g, '<br>')}</div>
                    <small>Updated: ${new Date(note.updated).toLocaleString()}</small>
                </div>
            `).join('');
        }

        // Form Handling
        document.getElementById('noteForm').addEventListener('submit', e => {
            e.preventDefault();
            const content = document.getElementById('noteContent').value.trim();
            if (content) {
                createNote(content);
                document.getElementById('noteContent').value = '';
            }
        });

        // Initial setup
        renderNotes();
        if (isFirefox) {
            syncWithFirefox();
            setInterval(syncWithFirefox, 30000); // Sync every 30 seconds
        }
    </script>
</body>
</html>
